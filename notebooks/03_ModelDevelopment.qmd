---
title: "Credit Risk Scorecard Model - Model Development"
author: "Mayank Lal"
date: today
format: 
    html:
        code-fold: true
        code-summary: "Code"
        code-overflow: wrap
execute:
  echo: false
  include: false
  warning: false
---
```{r setup}
## Exploratory Data Analysis
library(tidyverse) # Data Manipulation and Visualizaton
library(data.table) # Large datasets
library(vtable) # Formatted Summary Table
library(corrplot) # Correlation
library(patchwork) # Grid of plots
library(scales) # For Percentage Labels
library(rpart) # Simple Decision Tree for interaction analysis
library(rpart.plot) # Plotting Decision Trees

## Variable Selection and Feature Engineering
library(scorecard) # Information Value
library(pROC) # Gini
library(gt) # Formattting Table for publishing
library(knitr) # For simple formatting
library(DT) # For interactive tables
library(stringr) # Selecting sub-strings
library(Hmisc) # Variabel Clustering
```

This is a rough sketch notebook. We will furnish it before publishing.

```{r data}
# Load Model Data
load(file = "/workspace/Projects/kaggle-credit-risk-s5e11/data/processed/train_final_lr.Rdata")

# Load Test Data
test <- fread("/workspace/Projects/kaggle-credit-risk-s5e11/data/raw/test.csv")
```

## Model Development

Let's start with model development. First, we will use logistic regression.

### Logistic Regression - Model 6 (The True One)

This is our sixth logistic regression model. But truly the first after getting a proper understanding of data and process flow. 

Fingers crossed. Here is hoping to cross the barrier of 0.92 using a wholistic approach.

```{r lr6}
# Build Logistic Regression Model
model_woe_lr6 <- glm(loan_paid_back ~ working_flag_woe +    debt_to_income_ratio_woe + credit_score_woe + interest_rate_woe + education_level_woe + loan_purpose_woe + annual_income_woe + credit_score_woe*interest_rate_woe + debt_to_income_ratio_woe*credit_score_woe, data = train_final_lr, family = binomial(link = logit))

summary(model_woe_lr6)
```

```{r lr6_eval_perf}
train_final_lr$pred_woe <- predict(model_woe_lr6, type = "response")
roc_woe_lr6 <- roc(train_final_lr$loan_paid_back, train_final_lr$pred_woe)
auc_woe_lr6 <- auc(roc_woe_lr6)
gini_woe_lr6 <- 2*auc_woe_lr6 - 1

auc_woe_lr6
gini_woe_lr6
```

```{r test_pred_lr6}
# Apply WoE encoding to variables of test dataset
test_final_lr$loan_paid_back <- predict(model_woe_lr6, newdata=test_final_lr, type = "response")

test_submission_lr6 <- test_final_lr %>% select(id, loan_paid_back)

write.csv(test_submission_lr6, "/workspace/Projects/kaggle-credit-risk-s5e11/outputs/submission_lr6.csv", row.names = FALSE)
```
